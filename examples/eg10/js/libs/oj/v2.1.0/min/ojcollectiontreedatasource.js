/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common","ojs/ojmodel"],function(a){a.og=function(a,c,b,d,e){this.rN=a;this.fb=c;this.qX=[];this.eG=b;this.start=d<c.length?d:c.length-1;this.count=-1===e?c.length:Math.min(c.length,e)};o_("CollectionNodeSet",a.og,a);a.og.prototype.A_=function(a){this.a6(this).then(function(){a.success&&a.success()})};a.og.prototype.a6=function(a){return new Promise(function(c){function b(e){e<d?a.Ija(e,{success:function(c){null!==c?a.a6(c).then(function(){b(e+1)}):b(e+
1)}}):c(void 0)}var d=a.getCount();b(0)})};a.og.prototype.Ija=function(a,c){var b=this.fb.at(a);if(this.eG.EA(b).leaf)this.qX[a]=null,c.success(null);else{var d=this.eG.oG(b),b=this.eG.EA(b).key,e=this;this.eG.XA(d,0,-1,{success:function(b){e.qX[a]=b;c.success(b)}},b)}};a.og.prototype.getParent=function(){return this.rN};a.b.g("CollectionNodeSet.prototype.getParent",{getParent:a.og.prototype.getParent});a.og.prototype.getStart=function(){return this.start};a.b.g("CollectionNodeSet.prototype.getStart",
{getStart:a.og.prototype.getStart});a.og.prototype.getCount=function(){return this.count};a.b.g("CollectionNodeSet.prototype.getCount",{getCount:a.og.prototype.getCount});a.og.prototype.getData=function(a){this.dR(a);return this.fb.at(a).attributes};a.b.g("CollectionNodeSet.prototype.getData",{getData:a.og.prototype.getData});a.og.prototype.dR=function(a){if(a<this.start||a>this.start+this.count)throw"Out of range";};a.og.prototype.getMetadata=function(a){this.dR(a);var c={};a=this.fb.at(a);a=this.eG.EA(a);
c.key=a.key;c.leaf=a.leaf;c.depth=a.depth;return c};a.b.g("CollectionNodeSet.prototype.getMetadata",{getMetadata:a.og.prototype.getMetadata});a.og.prototype.ni=function(a){this.dR(a);return this.qX[a]};a.b.g("CollectionNodeSet.prototype.getChildNodeSet",{ni:a.og.prototype.ni});a.nb=function(g){g=g||{};this.XF=g.root;this.PEa=g.childCollectionCallback;this.EA=g.parseMetadata;this.Vw=null;this.NA="none";this.Jf={};a.nb.u.constructor.call(this)};o_("CollectionTreeDataSource",a.nb,a);a.nb.prototype.EA=
function(a){return{key:a.idAttribute+"\x3d"+a.id}};a.b.ta(a.nb,a.uu,"oj.CollectionTreeDataSource");a.nb.prototype.Init=function(){a.nb.u.Init.call(this)};a.b.g("CollectionTreeDataSource.prototype.Init",{Init:a.nb.prototype.Init});a.nb.prototype.rh=function(a){var c=this.Jf[a];if(c&&0<c.length)return c.length;this.TX(a,{success:function(a){return a.length}});return-1};a.b.g("CollectionTreeDataSource.prototype.getChildCount",{rh:a.nb.prototype.rh});a.nb.prototype.TX=function(a,c){this.li(a,null,{success:function(a){c.success(a.fb)},
error:c.error})};a.b.g("CollectionTreeDataSource.prototype.getChildCollection",{TX:a.nb.prototype.TX});a.nb.prototype.li=function(a,c,b){c=c||{};var d=c.start?c.start:0,e=c.count?c.count:-1;if(null===a)this.XA(null,d,e,b,null);else{var f=this;this.ZS(this.XF,a,0).then(function(c){if(c){c=f.oG(c.Nt);try{f.XA(c,d,e,b,a)}catch(k){b&&b.error&&b.error({status:k.message})}}else b&&b.error&&b.error(a)})}};a.b.g("CollectionTreeDataSource.prototype.fetchChildren",{li:a.nb.prototype.li});a.nb.prototype.dka=
function(a,c,b){var d=0;b&&b.at&&(d=b.at);c=this.hJ(c);a=this.cI(this,"insert",d,c,this.naa(null!=c&&0<c.length?c[c.length-1]:null,a));this.handleEvent("change",a)};a.nb.prototype.eka=function(a,c,b){var d=0;b&&b.index&&(d=b.index);this.zAa(a);a=this.cI(this,"delete",d,this.hJ(c),null);this.handleEvent("change",a)};a.nb.prototype.fka=function(a){var c=this.Qsa(a),b=null,d=null;c&&(b=c.index,d=this.hJ(c.fb));a=this.cI(this,"update",b,d,this.naa(null!=d&&0<d.length?d[d.length-1]:null,a));this.handleEvent("change",
a)};a.nb.prototype.xja=function(a){a=this.cI(this,"refresh",null,this.hJ(a),null);this.handleEvent("refresh",a)};a.nb.prototype.naa=function(g,c){var b=new a.l;b.add(c);return this.u7(b,g,0,1)};a.nb.prototype.hJ=function(g){var c=[],b=null;do b=this.Uta(g),null!==b&&(b!==a.nb.g0&&c.unshift(b),g=this.Rsa(b));while(null!=b);return c};a.nb.g0="%!@ROOT%#@!";a.nb.prototype.JI=function(g){var c=g instanceof a.C?this.EA(g).key:g;return g?c:a.nb.g0};a.nb.prototype.W2=function(a){return this.Jf[this.JI(a)]};
a.nb.prototype.Jba=function(g,c){c.on(a.la.Q.ADD,this.dka,this);c.on(a.la.Q.REMOVE,this.eka,this);c.on(a.la.Q.CHANGE,this.fka,this);c.on(a.la.Q.SYNC,this.xja,this);this.Jf[this.JI(g)]=c};a.nb.prototype.zAa=function(a){a=this.JI(a);for(var c in this.Jf)if(this.Jf.hasOwnProperty(c)&&c===a){this.Jf[a].off(null,null,this);delete this.Jf[a];break}};a.nb.prototype.dya=function(a,c){for(var b=c.length,d=0;d<b;d++){var e=this.JI(c.at(d));if(a===e)return!0}return!1};a.nb.prototype.Qsa=function(a){for(var c in this.Jf)if(this.Jf.hasOwnProperty(c))for(var b=
this.Jf[c],d=0;d<b.length;d++)if(b.at(d)===a)return{index:d,fb:b};return null};a.nb.prototype.Rsa=function(a){for(var c in this.Jf)if(this.Jf.hasOwnProperty(c)){var b=this.Jf[c];if(this.dya(a,b))return b}return null};a.nb.prototype.Uta=function(a){for(var c in this.Jf)if(this.Jf.hasOwnProperty(c)&&this.Jf[c]===a)return c;return null};a.nb.prototype.oG=function(a){var c=!0,b=this.W2(a);b||(c=!1,b=this.PEa(this.XF,a),null!=b&&(this.y3(b),this.Jba(a,b)));return{fb:b,mX:c}};a.nb.prototype.cI=function(a,
c,b,d,e){return{source:a,operation:c,index:b,parent:d,data:e}};a.nb.prototype.XA=function(a,c,b,d,e){var f=this;null===a&&((a=this.W2(null))?a={fb:a,mX:!0}:(a={fb:f.XF,mX:!1},f.Jba(null,this.XF)));a&&f.X5(a,function(a){d.success&&d.success(f.u7(a,e,c,b))},d.error)};a.nb.prototype.u7=function(g,c,b,d){return new a.og(c,g,this,b,d)};a.nb.prototype.zBa=function(a,c){var b=this;return new Promise(function(d){function e(a,c,g){a<c.length?c.at(a,{deferred:!0}).then(function(l){if(l){var m=b.EA(l);if(g===
m.key){d(l);return}}a++;e(a,c,g)}):d(null)}e(0,a,c)})};a.nb.prototype.ZS=function(a,c,b){var d=this;return new Promise(function(e){d.zBa(a,c).then(function(f){function h(d,f){if(d<k){var r=f.oG(a.at(d));r.fb?f.X5(r,function(a){f.ZS(a,c,b+1).then(function(a){a?e(a):(d++,h(d,f))})},null):(d++,h(d,f))}else e(null)}if(f)e({Nt:f,depth:b});else{var k=a.length;h(0,d)}})})};a.nb.prototype.X5=function(a,c,b){a.mX?c(a.fb):(this.Vw&&"none"!==this.Vw&&(a.fb.Rl=this.Vw,a.fb.OZ=this.NA),0<a.fb.length||!a.fb.Uja()?
c(a.fb):a.fb.fetch({success:function(a){c(a)},error:b}))};a.nb.prototype.Sz=function(a,c){var b=this;null===a?this.XA(null,0,-1,{success:function(a){a.A_({success:function(){c.success&&c.success(a)}})}},null):this.ZS(this.XF,a,0).then(function(d){d&&(d=b.oG(d.Nt),b.XA(d,0,-1,{success:function(a){a.A_({success:function(){c.success&&c.success(a)}})}},a))})};a.b.g("CollectionTreeDataSource.prototype.fetchDescendants",{Sz:a.nb.prototype.Sz});a.nb.prototype.sort=function(a,c){var b=a.key,d=a.direction,
e=!1;b!==this.Vw&&(this.Vw=b,e=!0);d!==this.NA&&(this.NA=d,e=!0);if(e){"none"===this.NA&&(this.Jf={});for(var f in this.Jf)this.Jf.hasOwnProperty(f)&&this.y3(this.Jf[f])}c&&c.success&&c.success()};a.b.g("CollectionTreeDataSource.prototype.sort",{sort:a.nb.prototype.sort});a.nb.prototype.y3=function(a){a.comparator=this.Vw;a.sortDirection="ascending"===this.NA?1:-1;a.sort()};a.nb.prototype.Rq=function(){return{key:this.Vw,direction:this.NA}};a.b.g("CollectionTreeDataSource.prototype.getSortCriteria",
{Rq:a.nb.prototype.Rq});a.nb.prototype.move=function(){a.o.ld()};a.b.g("CollectionTreeDataSource.prototype.move",{move:a.nb.prototype.move});a.nb.prototype.moveOK=function(){return"invalid"};a.b.g("CollectionTreeDataSource.prototype.moveOK",{moveOK:a.nb.prototype.moveOK});a.nb.prototype.getCapability=function(a){return"sort"===a?"default":"move"===a?"none":"batchFetch"===a||"fetchDescendants"===a?"disable":null};a.b.g("CollectionTreeDataSource.prototype.getCapability",{getCapability:a.nb.prototype.getCapability})});